name: Update API Docs

on:
  push:
    branches:
      - master # Run only on master branch updates

jobs:
  build-and-sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Permission to commit back to the repo

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          java-version: '17' # Use your project's Java version
          distribution: 'temurin'

      # Step 3a: For Maven
      - name: Build and Generate OpenAPI Spec (Maven)
        run: ./mvnw clean verify -Dspring-boot.run.profiles=test
        # 'verify' triggers the springdoc plugin execution configured in Phase 1

      # Step 3b: For Gradle (Uncomment if using Gradle)
      # - name: Build and Generate OpenAPI Spec (Gradle)
      #   run: ./gradlew clean generateOpenApiDocs

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: update openapi.json [skip ci]"
          file_pattern: docs/openapi.json